<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Velkoobjemový odpad v Praze 8</title>

    <!-- Core CSS -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="assets/typeahead.js/typeahead.js-bootstrap.css" rel="stylesheet" type="text/css"> <!--https://github.com/jharding/typeahead.js-bootstrap.css-->
    <link href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <style>
        html, body, #map {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body {
            padding-top: 50px;
        }
        label {
            font-weight: normal;
            margin-bottom: 0px;
        }
        input[type="radio"], input[type="checkbox"] {
            margin: 0;
        }
        .table {
            margin-bottom: 0px;
        }
        #loading {
            position: absolute;
            width: 220px;
            height: 19px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -110px;
            z-index: 20001;
        }
        .navbar .navbar-brand {
            font-weight: bold;
            font-size: 25px;
            color: white;
        }
        .navbar-collapse.in {
            overflow-y: hidden;
        }
        .tt-dropdown-menu {
            overflow: auto;
        }
        .tt-hint, .tt-query {
            display: block;
            width: 100%;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
        }
        .typeahead-header {
            margin: 0 5px 5px 5px;
            padding: 3px 0;
            border-bottom: 1px solid #ccc;
        }
        .search-container {
            width: 250px;
        }
        #searchbox {
            -webkit-border-top-left-radius: 4px;
            -webkit-border-bottom-left-radius: 4px;
            -moz-border-top-left-radius: 4px;
            -moz-border-bottom-left-radius: 4px;
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }
        .leaflet-control-layers-base input, .leaflet-control-layers-overlays input {
            float: left;
            margin-right: 6px;
        }
        .leaflet-control-layers-expanded {
            opacity: 0.9;
        }
        .leaflet-popup-content {
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 5px;
            margin-right: 5px;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 5px;
        }
        @media (max-width: 992px) {
            .navbar .navbar-brand {
                font-size: 18px;
                float: left;
            }
            .search-container {
                width: 150px;
            }
            .leaflet-control-attribution {
                display: none;
            }
        }
        @media (max-width: 767px){
            .search-container {
                width: 100%;
            }
        }
            /* Print Handling */
        @media print {
            .navbar {
                display: none !important;
            }
            .leaflet-control-container {
                display: none !important;
            }
        }
    </style>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.2.0/respond.js"></script>
    <![endif]-->
</head>

<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Velkoobjemový odpad</a>
    </div>
    <div class="navbar-collapse collapse" id="navbar-collapse">
        <ul class="nav navbar-nav">
            <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" onclick="$('#aboutModal').modal('show'); return false;"><i class="fa fa-question-circle" style="color: white"></i>&nbsp;&nbsp;About</a></li>
        </ul>
    </div><!--/.navbar-collapse -->
</div>

<div id="map"></div>
<div id="loading" style="display:block;">
    <div class="loading-indicator">
        <div class="progress progress-striped active">
            <div class="progress-bar progress-bar-info" style="width: 100%"></div>
        </div>
    </div>
</div>

<div class="modal fade" id="aboutModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Welcome to the BootLeaf template!</h4>
            </div>

            <div class="modal-body">
                <ul id="aboutTabs" class="nav nav-tabs">
                    <li class="active"><a href="#about" data-toggle="tab"><i class="fa fa-question-circle"></i>&nbsp;About the project</a></li>
                </ul>
                <div id="aboutTabsContent" class="tab-content" style="padding-top: 10px;">
                    <div class="tab-pane fade active in" id="about">
                        <p>A simple template for building web mapping applications with <a href="http://getbootstrap.com/">Bootstrap 3</a> and <a href="http://leafletjs.com/" target="_blank">Leaflet</a>.</p>
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                Features
                            </div>
                            <ul class="list-group">
                                <li class="list-group-item">Fullscreen mobile-friendly map template with responsive navbar and modal placeholders</li>
                                <li class="list-group-item">jQuery loading of external GeoJSON files</li>
                                <li class="list-group-item">Elegant client-side multi-layer feature search with autocomplete using <a href="http://twitter.github.io/typeahead.js/" target="_blank">typeahead.js</a></li>
                                <li class="list-group-item">Integration of Bootstrap tables into Leaflet popups</li>
                                <li class="list-group-item">Logic for minimizing layer control on small screens</li>
                                <li class="list-group-item">Marker icons included in layer control</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js?2"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
<script type="text/javascript" src="js/leaflet-google.js"></script>
<script type="text/javascript">
// Basemap Layers
var mapquestOSM = L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
    maxZoom: 19,
    subdomains: ["otile1", "otile2", "otile3", "otile4"],
    attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
});
// Google Maps Layer
var googleRoad = new L.Google('ROADMAP');
// Nokia Maps Layers
var nokiaNormalDay = L.tileLayer('http://{s}.maptile.lbs.ovi.com/maptiler/v2/maptile/newest/normal.day/{z}/{x}/{y}/256/png8?token={devID}&app_id={appID}', {
    attribution: 'Map &copy; <a href="http://developer.here.com">Nokia</a>, Data &copy; NAVTEQ 2014',
    subdomains: '1234',
    devID: 'Jh1fw3YBiKJpi3z63De9mg',
    appID: 'y03pI8hp5RCNmh0kc7Rl'
});
var nokiaSatelliteYesLabelsDay = L.tileLayer('http://{s}.maptile.lbs.ovi.com/maptiler/v2/maptile/newest/hybrid.day/{z}/{x}/{y}/256/png8?token={devID}&app_id={appID}', {
    attribution: 'Map &copy; <a href="http://developer.here.com">Nokia</a>, Data &copy; NAVTEQ 2014',
    subdomains: '1234',
    devID: 'Jh1fw3YBiKJpi3z63De9mg',
    appID: 'y03pI8hp5RCNmh0kc7Rl'
});

var map = L.map("map", {
    zoom: 13,
    center: [50.11, 14.47],
    layers: [googleRoad]
});

var scaleControl = L.control.scale();

// Larger screens get scale control and expanded layer control
if (document.body.clientWidth <= 767) {
    var isCollapsed = true;
} else {
    var isCollapsed = false;
    map.addControl(scaleControl);
};

var baseLayers = {
    "Google": googleRoad,
    "MapQuest OSM": mapquestOSM,
    "Nokia": nokiaNormalDay,
    "Nokia satelitní": nokiaSatelliteYesLabelsDay
};

var layerControl = L.control.layers(baseLayers, null, {
    collapsed: isCollapsed
}).addTo(map);

var markerLayerGroup = L.layerGroup().addTo(map);

function getPins(e){
    bounds = map.getBounds();
    url = "container/within?lat1=" + bounds.getSouthWest().lat + "&lon1=" + bounds.getSouthWest().lng + "&lat2=" + bounds.getNorthEast().lat + "&lon2=" + bounds.getNorthEast().lng;
    $.get(url, pinTheMap, "json")
}

function pinTheMap(data){
    $("#loading").hide();
    //clear the current pins
    map.removeLayer(markerLayerGroup);

    //add the new pins
    var markerArray = new Array(data.length)
    for (var i = 0; i < data.length; i++){
        container = data[i];
        markerArray[i] = L.marker([container.lat, container.lon]).bindPopup(container.name);
    }

    markerLayerGroup = L.layerGroup(markerArray).addTo(map);
}

function getUnknownPlaces() {
    $.get('place/unknown', processUnknownPlaces, 'json');
}

function processUnknownPlaces(data) {
    console.log(data);
    // TODO: give user option to manually place pin for each place returned
}

map.whenReady(getPins);

// Placeholder hack for IE
if (navigator.appName == "Microsoft Internet Explorer") {
    $("input").each( function () {
        if ($(this).val() == "" && $(this).attr("placeholder") != "") {
            $(this).val($(this).attr("placeholder"));
            $(this).focus(function () {
                if ($(this).val() == $(this).attr("placeholder")) $(this).val("");
            });
            $(this).blur(function () {
                if ($(this).val() == "") $(this).val($(this).attr("placeholder"));
            });
        }
    });
}
</script>
</body>
</html>